<%#
LuCI - Lua Configuration Interface
Copyright 2010 Jo-Philipp Wich <xm@subsignal.org>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

	http://www.apache.org/licenses/LICENSE-2.0

$Id: backup.htm 5448 2009-10-31 15:54:11Z jow $

-%>

<%+header%>

<script language="javascript">
function backup()
{
	self.location.href="<%=REQUEST_URI%>?backup=kthxbye";
	return true;
}

function defaults()
{
	if (confirm('<%:Proceed reverting all settings and resetting to firmware defaults?%>'))
	  {
		self.location.href="<%=REQUEST_URI%>?reset=yarly";
		return true;
	  }

	 return false;
}
function usboper(val)
{
	if (val == "backup" )
	   {
	   	if (!confirm('<%:Are you sure backup configuration to usb storage ?%>'))
	   	   {
	   	   	return false;
	   	   }
	   	   
	   	document.getElementById("operusb").value="backupusb"
	   }
	else
	   {
	   	/*restore */
		if (!confirm('<%:Are you sure restore configuration from usb storage ?%>'))
	   	   {	   	   	
	   	   	return false;
	   	   }
	   	document.getElementById("operusb").value="restoreusb"
	   }
	document.getElementById("usbform").submit();
	return true;
}


</script>

	<div class="cbi-content">
        <div class="cbi-section">
        	<div class="cbi-section-bg">
        		<div class="cbi-section-title"><%:Backup / Restore%>&nbsp;&nbsp;</div>
            </div>
    	</div>
        <div class="cbi-section">
            <div class="cbi-section-bg">
                <div class="cbi-map">
                    <div class="cbi-value">
                        <div class="cbi-value-title"><%:Backup file%></div>
                        <div class="cbi-value-field"><input class="cbi-button" type="button" value="<%:Backup%>" onclick="backup()" /></div>
                    </div>
                
                <% if backup_usb_valid then -%>
                	<form method="post" action="<%=REQUEST_URI%>" id="usbform" name="usbform" >
                		<div class="cbi-value">
                			<div class="cbi-value-title"><%:USB partition select: %></div>
                			<div class="cbi-value-field">
                				<select  name ="usbselect"  id = "usbselect">
                					<%            
										usbdev= luci.sys.usb_info()    						
                						for i, usbid in ipairs(usbdev) do
                					-%>
                					<option value="<%=usbid %>"><%=usbid %></option>
                					<% end -%>
                				</select>  
                				<input type="hidden" name="operusb" id="operusb" value="" > 
                				<input type="hidden" name="usbmessage" id="usbmessage" value="" > 
                			</div>                			
                		 </div>
                		  <div class="cbi-value">
                		 	<div class="cbi-value-title"><%:Backup config to USB partition  %></div>
                		 	<div class="cbi-value-field">
                		 		<input style="width:125px;" type="button" value="<%:Backup to USB%>" onclick="usboper('backup')" />
                		 	</div>
                		 </div>                		 
                		 <div class="cbi-value">
                		 	<div class="cbi-value-title"><%:Restore config by USB partition  %></div>
                		 	<div class="cbi-value-field">
                		 		<input style="width:125px;" type="button" value="<%:Rrestore from USB%>" onclick="usboper('restore')" />
                		 	</div>
                		 </div>
                	</form>
                <% end -%>
                <% if usb_status then -%>
                	 	<div class="cbi-value">
                	 		
                	 			<iframe src="<%=REQUEST_URI%>?operusb=<%=operusb%>&#38;usbselect=<%=usbselect%>&#38;usbmessage=<%=usbmessage%>" style="border:1px solid black; width:480px; height:100px"></iframe>
                	 		
                	 	</div>
                  <% end -%>
				  <div class="cbi-value">
				  </div>
				  <% if reset_avail then -%>
                	<div class="cbi-value">
                        <div class="cbi-value-title"><%:Reset router to defaults%></div>
                        <div class="cbi-value-field"><input class="cbi-button" type="button" value="<%:Default%>" onclick="defaults()" /></div>
                    </div>
                <% end -%>
<form method="post" action="<%=REQUEST_URI%>" enctype="multipart/form-data">
								<div class="cbi-value">
                        <div class="cbi-value-title"><%:Restore file%></div>
                        <div class="cbi-value-field"><input type="file" name="archive" /> <input class="cbi-button" type="submit" value="<%:Restore%>" /></div>
                    </div>               
</form>
                </div>               
            </div>
    	</div>
    </div>

<%+footer%>